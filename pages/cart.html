<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../imgs/logo2.png" type="image/x-icon">
    <!-- css link -->
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../styles/appetizers.css">
    <!-- bootstrap links -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Papa John's | Cart</title>
</head>

<body>
    <header>
        <nav class="topnav">
            <img src="../imgs/number.png" alt="num">
            <ul>
                <li><a href="#" data-translate="CAREERS">CAREERS</a></li>
                <li><a href="customer.html" data-translate="CONTACTS">CONTACTS</a></li>
            </ul>
            <img src="../imgs/arabic.png" alt="arabic" id="language-toggle">
        </nav>
        <nav class="subnav">
            <a href="../index.html">
                <img src="../imgs/logo.png" alt="logo" class="logo" id="main-logo">
            </a>
            <span class="menu-toggle" onclick="toggleMenu()">&#9776;</span>
            <ul id="menu">
                <li><a href="../index.html" data-translate="HOME">HOME</a></li>
                <li class="dropdown">
                    <a href="#" data-translate="Menu">Menu &#x25BC;</a>
                    <ul class="submenu">
                        <li><a href="../pages/promotions.html" data-translate="PROMOTIONS">PROMOTIONS</a></li>
                        <li><a href="../pages/pizzas.html" data-translate="PIZZAS">PIZZAS</a></li>
                        <li><a href="../pages/appetizers.html" data-translate="APPETIZERS">APPETIZERS</a></li>
                    </ul>
                </li>
                <li><a href="qulaity.html" data-translate="Quality">Quality</a></li>
                <li><a href="customer.html" data-translate="Customer Service">Customer Service</a></li>
            </ul>
            <div class="icons">
                <a href="../pages/cart.html" class="cart-icon position-relative">
                    <i class="fa-solid fa-cart-shopping fa-xl"></i>
                    <span id="cart-count"
                        class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-success">
                        0 <!-- Default value -->
                    </span>
                </a>
                <a href="../profile/profile.html" class="profile-icon"><i class="fa-regular fa-user fa-xl"></i></a>
            </div>
        </nav>
    </header>
    <br>
    <!-- Cart Content -->
    <div class="container">
        <h2 style="color: #079469; padding-bottom: 15px;" data-translate="Your Cart">Your Cart</h2>
        <div id="cart-items">
            <!-- Cart items will be dynamically inserted here -->
        </div>

        <!-- Total and Checkout Button -->
        <div class="text-end">
            <h4 id="total-price" data-translate="Total">Total: EGP 0</h4>
            <button class="btn btn-success" onclick="checkout()" data-translate="Checkout">Checkout</button>
        </div>
    </div>
    <!-- footer -->
    <footer class="footer text-white text-center py-4">
        <div class="container">
            <!-- Top Navigation Links -->
            <div class="row">
                <div class="col-12">
                    <ul class="footer-links list-inline">
                        <li class="list-inline-item"><a href="promotions.html"
                                data-translate="PROMOTIONS">PROMOTIONS</a></li>
                        <li class="list-inline-item"><a href="pizzas.html" data-translate="PIZZAS">PIZZAS</a></li>
                        <li class="list-inline-item"><a href="appetizers.html"
                                data-translate="APPETIZERS">APPETIZERS</a></li>
                    </ul>
                    <ul class="footer-links list-inline">
                        <li class="list-inline-item"><a href="../index.html" data-translate="HOME">HOME</a></li>
                        <li class="list-inline-item"><a href="qulaity.html" data-translate="QUALITY">QUALITY</a></li>
                        <li class="list-inline-item"><a href="#" data-translate="BRANCHES">BRANCHES</a></li>
                        <li class="list-inline-item"><a href="#" data-translate="CAREERS">CAREERS</a></li>
                        <li class="list-inline-item"><a href="customer.html" data-translate="CUSTOMER SERVICE">CUSTOMER
                                SERVICE</a></li>
                        <li class="list-inline-item"><a href="customer.html" data-translate="CONTACTS">CONTACTS</a></li>
                        <li class="list-inline-item"><a href="customer.html" data-translate="PRIVACY POLICY">PRIVACY
                                POLICY</a></li>
                    </ul>
                </div>
            </div>

            <!-- Social Media Icons -->
            <div class="social-icons my-3">
                <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
            </div>

            <!-- Copyright and Development Credit -->
            <div class="footer-text">
                <p class="mb-1" data-translate="© 2025 Papa John's Egypt">© 2025 Papa John's Egypt</p>
                <p data-translate="Web Development by">Web Development by </p>
                <a href="https://fadyadel-fady-adels-projects.vercel.app/" class="text-white">Fady Adel</a>
            </div>
        </div>
    </footer>
    <!-- Toast Notification -->
    <div id="toast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive"
        aria-atomic="true" style="position: fixed; bottom: 20px; right: 20px;">
        <div class="d-flex">
            <div class="toast-body">
                <span id="toast-message"></span>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                aria-label="Close"></button>
        </div>
    </div>
</body>

<!-- bootstrap links -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
<!-- FontAwesome for Icons -->
<script src="https://kit.fontawesome.com/858c0c4340.js" crossorigin="anonymous"></script>
<script src="../app.js"></script>

<script>
    // Function to handle checkout
    function checkout() {
        const loggedInUser = localStorage.getItem("loggedInUser");
        if (!loggedInUser) {
            alert('Please sign in to proceed to checkout.');
            window.location.href = '../profile/profile.html'; 
            return;
        }

        const user = JSON.parse(localStorage.getItem(loggedInUser));
        if (!user.address) {
            alert('Please update your address in your profile before proceeding to checkout.');
            window.location.href = '../profile/profile.html'; 
            return;
        }

        // Get cart items
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        if (cart.length === 0) {
            alert('Your cart is empty.');
            return;
        }

        // Redirect to the checkout page
        window.location.href = 'checkout.html';
    }

    // Function to display cart items
    function displayCart() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const cartItemsContainer = document.getElementById('cart-items');
        let total = 0;

        if (cart.length === 0) {
            // Display empty cart message, image, and button
            cartItemsContainer.innerHTML = `
            <div style="text-align: center; margin-top: 50px;">
                <img src="../imgs/emtycart.jpg" alt="Empty Cart" style="width: 150px; height: 150px; margin-bottom: 20px;">
                <p style="font-size: 18px; color: #555;" data-translate="Your cart is empty">Your cart is empty.</p>
                <button 
                    style="background-color:  #ab131b; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px;"
                    onclick="window.location.href = 'pizzas.html'"
                    data-translate="Go to Pizzas"
                >
                    Go to Pizzas
                </button>
            </div>
        `;
            document.getElementById('total-price').textContent = 'Total: EGP 0';
            updateCartCount(); // Update the cart count
            return;
        }

        cartItemsContainer.innerHTML = cart.map((item, index) => {
            const price = parseFloat(item.price.replace('EGP ', ''));
            total += price * (item.quantity || 1);
            return `
            <div class="card mb-3">
                <div class="row g-0">
                    <div class="col-md-4">
                        <img src="${item.image}" class="img-fluid rounded-start" alt="${item.name}">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">${item.name}</h5>
                            <p class="card-text">${item.description}</p>
                            <p class="card-text"><strong data-translate="Price">Price:</strong> ${item.price}</p>
                            <p class="card-text"><strong data-translate="Quantity">Quantity:</strong> 
                                <button 
                                    style="background-color: #f0f0f0; border: 1px solid #ccc; padding: 5px 10px; margin: 0 5px; cursor: pointer; border-radius: 4px; font-size: 14px;" 
                                    onclick="updateQuantity(${index}, ${(item.quantity || 1) - 1})"
                                >-</button>
                                ${item.quantity || 1}
                                <button 
                                    style="background-color: #f0f0f0; border: 1px solid #ccc; padding: 5px 10px; margin: 0 5px; cursor: pointer; border-radius: 4px; font-size: 14px;" 
                                    onclick="updateQuantity(${index}, ${(item.quantity || 1) + 1})"
                                >+</button>
                            </p>
                            <button class="btn btn-danger" onclick="removeFromCart(${index})" data-translate="Remove">Remove</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        }).join('');

        document.getElementById('total-price').textContent = `Total: EGP ${total.toFixed(2)}`;
        updateCartCount(); 
    }

    // Function to update the quantity of an item in the cart
    function updateQuantity(index, newQuantity) {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        if (newQuantity <= 0) {
            cart.splice(index, 1); 
        } else {
            cart[index].quantity = newQuantity;
        }
        localStorage.setItem('cart', JSON.stringify(cart));
        displayCart(); // Refresh the cart display
    }

    // Function to remove an item from the cart
    function removeFromCart(index) {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        cart.splice(index, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
        displayCart(); // Refresh the cart display
    }

    // Function to show toast notification
    function showToast(message) {
        const toastElement = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');

        // Set the toast message
        toastMessage.textContent = message;

        // Initialize the toast (if not already initialized)
        const toast = new bootstrap.Toast(toastElement, {
            autohide: true, // Automatically hide the toast
            delay: 3000 // Hide after 3 seconds
        });

        // Show the toast
        toast.show();
    }

    // Display cart items and user details when the page loads
    displayCart();
    displayUserDetails();

    // Language Toggle Functionality
    document.addEventListener('DOMContentLoaded', function () {
        const languageToggle = document.getElementById('language-toggle');
        const mainLogo = document.getElementById('main-logo');
        let currentLanguage = 'en';

        languageToggle.addEventListener('click', function () {
            currentLanguage = currentLanguage === 'en' ? 'ar' : 'en';
            fetch('../data/translate.json')
                .then(response => response.json())
                .then(translations => {
                    const langData = translations[currentLanguage];
                    document.querySelectorAll('[data-translate]').forEach(element => {
                        const key = element.getAttribute('data-translate');
                        if (langData[key]) {
                            element.textContent = langData[key];
                        }
                    });

                    // Toggle the language toggle image
                    if (currentLanguage === 'ar') {
                        languageToggle.src = '../imgs/english.png';
                        mainLogo.src = '../imgs/logo-ar.png';
                    } else {
                        languageToggle.src = '../imgs/arabic.png';
                        mainLogo.src = '../imgs/logo.png';
                    }

                    // Update the direction of the body for RTL support
                    document.body.setAttribute('dir', currentLanguage === 'ar' ? 'rtl' : 'ltr');
                });
        });
    });
</script>

</html>